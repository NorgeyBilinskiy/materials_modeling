# üöÄ –ü—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

## üìã –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å `src/data_preprocessing.py` —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–∏–±–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É —á–µ—Ä–µ–∑ YAML —Ñ–∞–π–ª—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ª–µ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –§–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫: `settings/preprocessing_data_training/data_preprocessing.yaml`

```yaml
# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤—ã–±–æ—Ä–∫–∏ (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö)
data_splitting:
  # –î–ª—è –æ–±—ã—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (–Ω–µ –≤ —Å–ø–∏—Å–∫–µ predict)
  regular_materials:
    train_ratio: 0.8    # 80% –≤ train
    test_ratio: 0.2     # 20% –≤ test
  
  # –î–ª—è –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (–≤ —Å–ø–∏—Å–∫–µ predict)
  # –°—Ç—Ä—É–∫—Ç—É—Ä—ã —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —è–≤–Ω–æ –≤ predict_material.yaml
  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ

# –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ª–µ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
target_scaling:
  # –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ª–∏ —ç–Ω–µ—Ä–≥–∏—é —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è
  scale_formation_energy: false
  
  # –ú–µ—Ç–æ–¥ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
  # –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: "standard", "minmax", "robust"
  scaling_method: "standard"
  
  # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è minmax –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω)
  minmax:
    feature_range: [0, 1]
  
  # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è robust –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω)
  robust:
    quantile_range: [25.0, 75.0]

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–æ–≤
graph_features:
  # –†–∞–¥–∏—É—Å –ø–æ–∏—Å–∫–∞ —Å–æ—Å–µ–¥–µ–π (–≤ –∞–Ω–≥—Å—Ç—Ä–µ–º–∞—Ö)
  neighbor_cutoff: 5.0
  
  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—ë–±–µ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∞
  min_edges: 1

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logging:
  level: "INFO"
  show_progress: true
```

### –§–∞–π–ª –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä: `settings/materials/predict_material.yaml`

```yaml
predict_substances:
  - formula: NaCl
    structures:
      validation:
        - mp-22851    # –ö–£–ë–ò–ß–ï–°–ö–ê–Ø —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ NaCl (rock-salt) - –¥–ª—è validation
      predict:
        - mp-1120767  # –¢–†–ò–ö–õ–ò–ù–ù–ê–Ø —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ NaCl - –¥–ª—è predict
    fallback: "any"
```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. `prepare_datasets_from_cif()`
–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –∏–∑ CIF —Ñ–∞–π–ª–æ–≤.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **–Ø–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä** –¥–ª—è predict –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (–±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤—â–∏–∫–∞ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)

### 2. `create_graph_features(structure, cutoff=None, min_edges=None)`
–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏–∑ –∫—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `structure`: Pymatgen Structure –æ–±—ä–µ–∫—Ç
- `cutoff`: –†–∞–¥–∏—É—Å –ø–æ–∏—Å–∫–∞ —Å–æ—Å–µ–¥–µ–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
- `min_edges`: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—ë–±–µ—Ä (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)

### 3. `_create_scaler(config)`
–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã:**
- `StandardScaler`: –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è (—Å—Ä–µ–¥–Ω–µ–µ=0, std=1)
- `MinMaxScaler`: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [0, 1]
- `RobustScaler`: –†–æ–±–∞—Å—Ç–Ω–∞—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è

### 4. `_apply_scaling(data_samples, scaler, config)`
–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∫ —Ü–µ–ª–µ–≤—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º.

## üìä –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### üéØ **–Ø–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä (NaCl)**
```
mp-22851 (–∫—É–±–∏—á–µ—Å–∫–∞—è) ‚Üí VALIDATION –Ω–∞–±–æ—Ä
mp-1120767 (—Ç—Ä–∏–∫–ª–∏–Ω–Ω–∞—è) ‚Üí PREDICT –Ω–∞–±–æ—Ä
mp-22862 (—Ç—Ä–∏–∫–ª–∏–Ω–Ω–∞—è) ‚Üí TRAIN/TEST –Ω–∞–±–æ—Ä—ã
```

### üìà **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (KCl, KBr, LiF)**
```
train: 80% | test: 20%
```

## üéØ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ** (`scale_formation_energy: false`)
- **–≠–Ω–µ—Ä–≥–∏—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö** (eV/atom)
- **–ù–∏–∫–∞–∫–∏—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è**

### –ü–æ—á–µ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å?
- **–ö—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**: –ù–ï –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è (—ç—Ç–æ –≥—Ä–∞—Ñ—ã)
- **–≠–Ω–µ—Ä–≥–∏—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è**: –ú–æ–∂–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –æ–±—É—á–µ–Ω–∏—è (–Ω–æ —Å–µ–π—á–∞—Å –æ—Ç–∫–ª—é—á–µ–Ω–æ)

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã (–µ—Å–ª–∏ –≤–∫–ª—é—á–∏—Ç—å):
1. **StandardScaler** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): `(x - Œº) / œÉ`
2. **MinMaxScaler**: `(x - min) / (max - min)`
3. **RobustScaler**: `(x - median) / IQR`

## üìÅ –°–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã

```
temporary_data/processed/
‚îú‚îÄ‚îÄ train.pt          # –û–±—É—á–∞—é—â–∞—è –≤—ã–±–æ—Ä–∫–∞
‚îú‚îÄ‚îÄ val.pt            # –í–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞  
‚îú‚îÄ‚îÄ test.pt           # –¢–µ—Å—Ç–æ–≤–∞—è –≤—ã–±–æ—Ä–∫–∞
‚îú‚îÄ‚îÄ predict.pt        # –í—ã–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
‚îî‚îÄ‚îÄ target_scaler.pkl # –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤—â–∏–∫ (–ù–ï —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
python test_preprocessing.py
```

### –¢–µ—Å—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä:
```bash
python test_structure_assignment.py
```

## üîÑ –û–±—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ü–æ—Å–∫–æ–ª—å–∫—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ, –æ–±—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

–ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –≤–∫–ª—é—á–∏—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
import pickle

# –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤—â–∏–∫
with open('temporary_data/processed/target_scaler.pkl', 'rb') as f:
    scaler = pickle.load(f)

# –û–±—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
original_energy = scaler.inverse_transform(scaled_energy.reshape(-1, 1))
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –í–∫–ª—é—á–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:
```yaml
target_scaling:
  scale_formation_energy: true
  scaling_method: "standard"
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è train/test
```yaml
data_splitting:
  regular_materials:
    train_ratio: 0.7    # 70% –≤ train
    test_ratio: 0.3     # 30% –≤ test
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
```yaml
target_scaling:
  scale_formation_energy: true
  scaling_method: "minmax"
  minmax:
    feature_range: [-1, 1]
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ predict
```yaml
predict_substances:
  - formula: NaCl
    structures:
      validation:
        - mp-22851    # –ö—É–±–∏—á–µ—Å–∫–∞—è
      predict:
        - mp-1120767  # –¢—Ä–∏–∫–ª–∏–Ω–Ω–∞—è
        - mp-22862    # –ï—â–µ –æ–¥–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è predict
    fallback: "any"
```

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–°—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è —è–≤–Ω–æ** - –Ω–∏–∫–∞–∫–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–ª—è predict –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ** - —ç–Ω–µ—Ä–≥–∏—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö (eV/atom)
3. **–ì—Ä–∞—Ñ—ã –ù–ï –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è** - —Ç–æ–ª—å–∫–æ —Ü–µ–ª–µ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á–∏—Ç—å)
4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
5. **Fallback –∑–Ω–∞—á–µ–Ω–∏—è** –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞

## üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `scikit-learn>=1.6.2` - –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –≤–∫–ª—é—á–∏—Ç—å)
- `torch-geometric>=2.6.1` - –¥–ª—è –≥—Ä–∞—Ñ–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `pymatgen>=2025.6.14` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏
